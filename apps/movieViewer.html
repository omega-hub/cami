<html lang="en">
<head>
    <title>Movie Viewer</title>
    <link rel="stylesheet" href="js/jquery.mobile-1.4.5.min.css">
    <script src="porthole/res/porthole.js"></script>
    <script src="js/jquery-1.12.0.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/hammer.js"></script>
    <script src="https://hammerjs.github.io/dist/hammer.js"></script>
    <script src='js/THREEx.WindowResize.js'></script>

    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <style>
    .button{
    background-color: #e8e9f0; 
    border: 1px black;
    color: black;
    text-align: center;
    vertical-align: middle;
    width:235px;
    height: 30px;
    font-size: 15px;
    margin: 4px 2px;
    border-radius: 1px;
    float: center;
    outline:none;
    box-shadow: inset -.5px -1px 5px 0px black;
    display:inline !important;

    
    }

    div.hide { display:none; }

    div.show {  }

    .image{
         border: 10px black;
    }

    .button:active{
      box-shadow: inset .5px 1px 5px 0px black;
    }


    .collapsable{
        outline:none;
    }

    #set3{
        outline:none;
    }
    .jquerymobileslider .ui-slider {
    height: 50px;
    width: 250px
    }

    .jquerymobileslider .ui-slider .ui-slider-handle {
        height: 50px;
        width: 50px;
    }
    /*#slider {
		margin: 15px;
    width: 200px;
    height: 20px;
	}
	#volSlider {
		margin: 20px;
    width: 200px;
	}*/

    .content{
        float: center;
        float: top;
    }
    .ui-slider-handle{
        color: black;
    }
    body { margin: 0; }
    canvas { width: 100%; height: 100% }
    </style> 

</head>

<body>
    <div data-role="page" id="movie-page">
    	<div data-role="header" id="header" data-position ="fixed">
            <a href="#nav-panel" data-icon="bars" data-iconpos="notext">Menu</a>
            <a href="#help-panel" data-icon="info"   data-iconpos="notext">Add</a>
            <h1>Movie Viewer</h1>
            <script src="js/three.min.js"></script>
            <script src="js/modelViewerPreview.js"></script> 
    	</div>

        <div data-role="footer" id="footer" data-position="fixed">
        <!-- <input type="range" name="slider" id="slider" value="60" min="0" max="100" data-theme="c"/> -->
        <input  input type="number" data-role="none" name="slider" id="slider" value="60" min="0" max="100" data-theme="c"/>
        
        <button type="button" id="play"data-inline="true"onClick='togglePlay()'>
            <div id="div1"> Play </div>
        </button>
        <button type="button" id="pause"data-inline="true"onClick='togglePlay()'>
            <div id="div2"/> Pause </div>
        </button>

        <button type="button" id="restart"data-inline="true" onClick='restart()'>Restart</button>
        <button type="button" id="loop"data-inline="true" onClick='loop()'>Loop</button>
        Time : <span id="cMinutes">0</span>:<span id="cSeconds">00</span> / <span id="fMinutes">0</span>:<span id="fSeconds">00</span> 
    </div>

    	<div data-role="panel" data-display="push" data-theme="b" id="nav-panel"> 
          <ul data-role="listview" class="panel">
            <li data-icon="delete"><a href="#" data-rel="close"  >Close menu</a></li>
            <div data-role="collapsible-set" class= "innerpanel" id="Allcollapsable">
            </div>
        </div>

</div>

<div data-role="panel" data-position="right" data-swipe-close = "false" data-position-fixed="true" data-display="overlay" data-theme="a" id="help-panel">
    <form class="userform">
        <h2>Instructions for Use</h2>
        <hr class="instructions">
            <h4>To Play/Pause:</h4> <p> Use the buttons on the bottom of the screen.</p>
            <h4>To Seek:</h4> <p> Move to a new place in the video with the slider or enter the percentage of the full video you would like to jump to.</p> 
             <h4>To Restart:</h4> <p> Restart the movie by pressing the Restart button at the bottom of the screen.</p>
            <h4>To close the sidebars:</h4> <p> Tap on the main screen.</p>

        </form>
</div><!-- /panel -->

    <!-- <input type="range" id="volume-bar" min="0" max="1" step="0.1" value="1"> -->
  <!-- Video -->
    <script>
   $("#play").hide();

    $("#play").on('click', function() {
    $("#play").hide();
    $("#pause").show();
    });

    $("#pause").on('click', function() {
    $("#pause").hide();
    $("#play").show();
    });

    $("#restart").on('click', function() {
    $("#play").hide();
    $("#pause").show();
    });
        porthole.connected = function() {
        	{{py startApplication(%client_id%, 'movieViewer') }}
            porthole.call("startApplication(%client_id%, 'hello')")
        }
        //$(document).ready(function () {}
        var playButton = document.getElementById("play-pause");
        var restart = document.getElementById("restart");
        //$(playButton).css({ width: '300px', 'padding-top': '10px', 'padding-bottom': '10px' });
        //creating a jquery function for always occuring events.
        var videoPlaying = false
        var seeking = false
        var videoLength = 0
        var currentTime = 0
        var looping = true
        var playing = true
        $(document).on("pageinit","#movie-page",function(){
            // PLACE ALL YOU EVENTS CODE HERE e.g.
            console.log("page init")
            $( "#slider" ).on( "slidestart", function( event, ui ) {seekStart(event,ui)} );
            $( "#slider" ).on( "slidestop", function( event, ui ) {seekEnd(event,ui)} );
            $( "#slider").slider() ;
        })
        
        onVideoLoad(135)
        // function pause(event) {
        //     console.log("Pause Button")
        // }

        function seekStart(event) {
            console.log("Seek Start")
            //{{mc@app: setPlaying(false) }}
            seeking = true
        }

        function seekEnd(event) {
            console.log("Seek End")
            //{{mc@app: setPlaying(videoPlaying) }}
            currentSeek = $('#slider').val()
            //console.log(currentSeek)
            //{{mc@app: seekToTime(currentSeek) }}
            seeking = false
        }

        function restart(event) {
            console.log("Reset Button")
            //{{mc@app: seekToTime(0) }}
            //{{mc@app: setPlaying(false) }}
            videoPlaying = false;
        }
        function loop(event) {
            console.log("Loop Button")
            console.log(looping)
            looping = !looping
            console.log(looping)
            if (looping) {
            	{{mc@app: setLooping(True) }}
            } else {
            	{{mc@app: setLooping(False) }}
            }
        }
        function togglePlay(event) {
            console.log("Play Button")
            console.log(playing)
            playing = !playing
            console.log(playing)
            if (looping) {
            	{{mc@app: setPlaying(True) }}
            } else {
            	{{mc@app: setPlaying(False) }}
            }
        }
        function select(event) {
            console.log("Select Video")
        }

        function onUpdate(event,ui) {
            requestAnimationFrame(onUpdate); 
            if (seeking == true) {
                currentSeek = $('#slider').val()//$("#video-controls").slider( "option", "value" );
                console.log(currentSeek)
                // currentSeek = $('#slider').slider("option","value")
                // console.log(currentSeek)
            } else {
                updateSlider()
            }
            $("#cMinutes").html(Math.floor(currentTime/60));
            var seconds 
            seconds = currentTime % 60
            if (seconds < 10) {
                $("#cSeconds").html("0" + seconds)
            } else {
                $("#cSeconds").html(seconds)
            }
            //$('#slider').parent().page();
            // $('#slider').slider("refresh")
        }
        function updateSlider() {
            //{{mc@app: setPlaying(false) }}
        }
        function setSliderTime(time) {
            $('#slider').val(time).slider("refresh");
        }
        function onVideoLoad(vidLength) {
            videoLength = vidLength
            console.log("On Video Load")
            console.log(videoLength)
            var minutes = Math.floor(videoLength/60)
            console.log(minutes)
            $("#fMinutes").html(minutes);
            var seconds 
            seconds = videoLength % 60
            console.log(seconds)
            if (seconds < 10) {
                $("#fSeconds").html("0" + seconds)
            } else {
                $("#fSeconds").html(seconds)
            }

            //$("#fSeconds").text("seconds")
        }

        function updateVideoData(isPlaying,isLooping,currenttime) {
        	if (playing != isPlaying) {
        		$("#play").hide();

			    $("#play").on('click', function() {
			    $("#play").hide();
			    $("#pause").show();
			    });

			    $("#pause").on('click', function() {
			    $("#pause").hide();
			    $("#play").show();
			    });

			    $("#restart").on('click', function() {
			    $("#play").hide();
			    $("#pause").show();
			    });
        	}
        	if (isLooping)
        }
        onUpdate()
    </script>
</body>
</html>
